---
title: "Working with date and time in R"
output: 
  revealjs::revealjs_presentation:
    transition: slide
    incremental: true
    theme: default
    highlight: haddock
    center: false
    reveal_options:
      slideNumber: true
      previewLinks: true
---

<style type="text/css">
  .reveal p {
    text-align: left;
    font-size: 20px;
  }
  .reveal body:after {
    content: url(handshake.png);
    position: fixed;
    bottom: 3.5em;
    left: 3.5em;
    box-shadow: 5px 5px 10px #000; 
  }
  .reveal hr {
    border-color: #0077aa;
  }
  .reveal h1, h2, h3, h4, h5, h6 {
    text-transform: capitalize;
    text-align: center;
    color: #0077aa;
    font-family: 'Helvetica Neue';
  }
  .reveal ul {
    display: block;
  }
  .reveal ul li {
    color: #3c3c3c; 
    /* set color of list item text */
    list-style: none; 
-  }

  .reveal ul li::before {
      color: #006b6e;  
      /* color of bullet or square */
      content: "\2022"; 
      /* Unicode of character to precede the list item */
      font-size: 1em; 
      /* em or %*/ 
      padding-right: 1.1225em; 
      /* use em*/
      position: relative;
      top: 0em; 
      /* use em or % */
  }
  .reveal ul {
    line-height:150%
  }
  .reveal .fragment {
    font-size: 20px;
  }
  .reveal ol {
    display: block;
  }
</style>

## Agenda

<hr>

## Introduction

<hr>

 In this module, we will learn to work with date/time data in R using [lubridate]( https://CRAN.R-project.org/package=lubridate), an R package that makes it easy to work with dates and time. Let us begin by installing and loading the lubridate pacakge.
 
## Installation

<hr>

```{r install, eval=FALSE}
library(lubridate)
library(dplyr)
library(magrittr)
```

```{r lub1, echo=FALSE, eval=TRUE, results='hide', message=FALSE}
library(lubridate)
library(dplyr)
library(magrittr)
```

## Quick Overview

<hr>

Use `origin` to get the origin for the `Date` and other date/time objects in R.

```{r origin}
lubridate::origin
```

## Current Date/Time

<hr>

There are functions to check current date, time, timezone and AM/PM. Let us take a quick look at these:

```{r today}
now()
today()
am(now())  
pm(now())
```

## Current Date/Time

<hr>

```{r today2}
am(now())  
pm(now())
```

## Case Study

<hr>

We will use a case study to explore the lubridate package. The data set can be downloaded from here or directly imported using the readr package.

```{r import, eval=FALSE}
transact <- readr::read_csv('https://raw.githubusercontent.com/rsquaredacademy/datasets/master/transact.csv')
```


```{r show, echo=FALSE, eval=TRUE, message=FALSE}
transact <- readr::read_csv('https://raw.githubusercontent.com/rsquaredacademy/datasets/master/transact.csv')
transact
```

## Data Dictionary

<hr>

The data set has 3 columns. All the dates are in the format (yyyy-mm-dd).

- Invoice: invoice date 
- Due: due date
- Payment: payment date

## Case Study

<hr>

We will use the functions in the lubridate package to answer a few 
questions we have about the transact data.

- extract date, month and year from Due
- compute the number of days to settle invoice
- compute days over due
- check if due year is a leap year
- check when due day in february is 29, whether it is a leap year
- how many invoices were settled within due date
- how many invoices are due in each quarter
- what is the average duration between invoice date and payment date

## Case Study

<hr>

extract date, month and year from Due

```{r lub2}
transact %>%
  mutate(
    due_day = day(Due),
    due_month = month(Due),
    due_year = year(Due)
  )
```

## Case Study

<hr>

compute the number of days to settle invoice

```{r lub3}
transact %>%
  mutate(
    days_to_pay = Payment - Invoice
  )
```

## Case Study

<hr>

compute days over due

```{r lub4}
transact %>%
  mutate(
    delay = Payment - Due
  )
```

## Case Study

<hr>

check if due year is a leap year

```{r lub5}
transact %>%
  mutate(
    due_year = year(Due),
    is_leap = leap_year(due_year)
  )
```

## Case Study

<hr>

check when due day in february is 29, whether it is a leap year

```{r lub6}
transact %>%
  mutate(
    due_day = day(Due),
    due_month = month(Due),
    days_due_month = days_in_month(due_month),
    due_year = year(Due),
    is_leap = leap_year(due_year)
  ) %>%
  select(-(Invoice), -(Payment)) %>%
  filter(due_month == 2)
```

## Case Study

<hr>

```{r lub7}
transact %>%
  mutate(
    inv_due_interval = interval(Invoice, Due),
    due_next = Due + days(1),
    due_pay_interval = interval(due_next, Payment),
    overlaps = int_overlaps(inv_due_interval, due_pay_interval)
  ) %>%
  select(inv_due_interval, due_next, due_pay_interval, overlaps)
```

## Case Study

<hr>

````{r lub12}
# using int_shift
transact %>%
  mutate(
    inv_due_interval = interval(Invoice, Due),
    due_pay_interval = interval(Due, Payment),  
    due_pay_next = int_shift(due_pay_interval, by = days(1)),
    overlaps = int_overlaps(inv_due_interval, due_pay_next)
  ) %>%
  select(inv_due_interval, due_pay_next, overlaps)
```

## Case Study

<hr>

```{r lub13}
transact %>%
  mutate(
    inv_due_interval = interval(Invoice, Due),
    overlaps = Payment %within% inv_due_interval
  ) %>%
  select(Due, Payment, overlaps)
```

----
```{r lub8}
transact %>%
  mutate(
    Quarter = quarter(Due)
  )
```

## Case Study

<hr>

```{r lub14}
transact %>%
  mutate(
    Quarter = quarter(Due, with_year = TRUE)
  )
```

## Case Study

<hr>

```{r lub9}
transact %<>%
  mutate(
    days_to_pay = Payment - Invoice
  )
```

## Case Study

<hr>

```{r lub15}
transact %>%
  mutate(
    dseconds = duration(as.numeric(days_to_pay), 'days')
  )
```

## Case Study

<hr>

```{r lub10}
transact %<>%
  mutate(
    inv_pay_int = interval(Invoice, Payment)
  )
```

## Case Study

<hr>

```{r lub11}
transact %>%
  mutate(
    inv_pay_days = inv_pay_int / ddays()
  )
```

## Case Study

<hr>

```{r lub16}
transact %>%
  mutate(
    inv_pay_days = time_length(inv_pay_int, unit = "days")
  )
```

## Case Study

<hr>

```{r lub17}
transact %>%
  mutate(
    inv_pay_days = as.period(inv_pay_int)
  )
```

## Questions

<hr>

## Thank You

<hr>
