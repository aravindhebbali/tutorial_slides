---
title: "Readable Code with Pipes"
output: 
  revealjs::revealjs_presentation:
    transition: slide
    incremental: true
    theme: moon
    highlight: monochrome
    center: true
    reveal_options:
      slideNumber: true
      previewLinks: true
---

## Introduction

When you are dealing with a sequence of multiple operations, R code can get a bit cramped and not so easy on the eyes. The [magrittr](https://CRAN.R-project.org/package=magrittr) package by Stefan Milton Bache provides pipes enabling us to write R code that is readable.

- especially useful when you have nested functions
- similar in spirit to javascript's method chaining
- functions taking multiple arguments can be confusing and messy to read
- with magrittr, you program from left to right

## Pipes

R being a functional language, code contains a lot of parentheses. Complex code results in nested functions making them hard to read and maintain.
If you are using tidyverse packages, magrittr will be automatically loaded. We will look at 3 different types of 
pipes:

- `%>%` : pipe operator - pipe a value forward into an expression or function call
- `%<>%`: compound assignment pipe operator - result assigned to left hand side object instead of returning it
- `%$%` : exposition pipe operator - expose names within left hand side objects to right hand side expressions

## %>%

## %<>%

## %$%

## Example 1

Let us look at a few examples:

```{r install, echo=FALSE, eval=TRUE, results='hide', message=FALSE}
library(magrittr)
```

```{r import, echo=FALSE, eval=TRUE, results='hide', message=FALSE}
ecom <- readr::read_csv('https://raw.githubusercontent.com/rsquaredacademy/datasets/master/web.csv')
```

```{r mag1}
head(ecom, 10)
```

----
```{r mag2}
ecom %>% head(10)
```

## Example 2

```{r mag3}
y <- ecom$n_pages
y <- sqrt(y)
head(y)
```

----
```{r mag4}
y <- ecom %$% n_pages
y %<>% sqrt()
head(y)
```

----
```{r mag5}
y <- ecom %$% 
  n_pages %>% 
  sqrt()
head(y)
```

## Correlation

```{r mag6}
ecom %>%
  subset(purchase == 'true') %$% 
  cor(n_pages, duration)
```

## Visualization

```{r mag7}
ecom %>%
  subset(purchase == 'true') %>%
  extract('referrer') %>%
  table() %>%
  barplot()
```

## Regression

```{r mag8}
ecom %$%
  lm(duration ~ n_pages) %>%
  summary()
```

## String Manipulation

```{r mag9}
email <- 'jovialcann@anymail.com'

toupper(strtrim(strsplit(email, '@')[[1]][1], 6))

email %>%
  strsplit(split = '@') %>%
  extract2(1) %>%
  extract(1) %>%
  strtrim(width = 6) %>%
  toupper()
```

## Data Extraction

```{r mag10}
ecom %>%
  extract('n_pages')
```

----
```{r mag22}
ecom %>%
  extract(6)
```

----
```{r mag11}
ecom %>%
  use_series('n_pages')
```

----
```{r mag12}
mt <- as.list(mtcars)
mt %>%
  extract2('mpg')
```

----
```{r mag13}
mt <- as.list(mtcars)
mt %>%
  extract2(1)
```

----
```{r mag14}
mt <- as.list(mtcars)
mt %>%
  use_series(mpg)
```

## Arithmetic Operations

```{r mag15}
1:10 %>%
  `+`(1)

1:10 %>%
  add(1)
```

----
```{r mag16}
1:10 %>%
  `*`(3)

1:10 %>%
  multiply_by(3)
```

----
```{r mag17}
1:10 %>%
  `/`(2)

1:10 %>%
  divide_by(2)
```

----
```{r mag18}
1:10 %>%
  `^`(2)

1:10 %>%
  raise_to_power(2)
```

## Logical Operators

----
```{r mag19}
1:10 %>%
  `>`(5)

1:10 %>%
  is_greater_than(5)
```

----
```{r mag20}
1:10 %>%
  `>=`(5)

1:10 %>%
  is_weakly_greater_than(5)
```

## Summary
