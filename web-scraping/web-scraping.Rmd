---
output: _output.yaml
---

## {data-background="img/ws_cover_image.png"}

## Connect With Us

<hr>

- Website     (https://www.rsquaredacademy.com/)
- Free Online R Courses   (https://rsquared-academy.thinkific.com/)
- R Packages  (https://pkgs.rsquaredacademy.com)
- Shiny Apps  (https://apps.rsquaredacademy.com)
- Blog        (https://blog.rsquaredacademy.com)
- GitHub      (https://github.com/rsquaredacademy)
- YouTube     (https://www.youtube.com/user/rsquaredin/)
- Twitter     (https://twitter.com/rsquaredacademy)
- Facebook    (https://www.facebook.com/rsquaredacademy/)
- Linkedin    (https://in.linkedin.com/company/rsquared-academy)

## {data-background="img/ws_agenda.png"}

<br>
<br>
<br>
<br>

> - what?
> - why?
> - how?
> - use cases
> - HTML basics
> - case studies

## {data-background="img/ws_section_intro.png"}

## {data-background="img/ws_what.png"}

## {data-background="img/ws_how.png"}

## {data-background="img/ws_why_1.png"}

## {data-background="img/ws_why_2.png"}

## {data-background="img/ws_why_1a.png"}

## {data-background="img/ws_use_cases.png"}

## {data-background="img/ws_case_studies.png"}

## {data-background="img/ws_keep_in_mind.png"}

## {data-background="img/ws_section_html.png"}

## {data-background="img/ws_htmL_css_js.png"}

## {data-background="img/ws_htmL_tags_2.png"}

## {data-background="img/ws_htmL_tags.png"}

## {data-background="img/ws_htmL_dom.png"}

## {data-background="img/ws_html_attributes.png"}

## {data-background="img/ws_section_case_studies.png"}

## Libraries

<hr>

```{r libs, message=FALSE, warning=FALSE}
library(robotstxt)
library(rvest)
library(selectr)
library(xml2)
library(dplyr)
library(stringr)
library(forcats)
library(magrittr)
library(tidyr)
library(ggplot2)
library(lubridate)
library(tibble)
library(purrr)
```

## {data-background="img/ws_cs_top_mobiles.png"}

## robotstxt

<hr>

```{r phones1}
paths_allowed(
  paths = c("https://www.amazon.in/mobile-phones/b?ie=UTF8&node=1389401031&ref_=nav_shopall_sbc_mobcomp_all_mobiles")
)
```

## Read Web Page

<hr>

```{r phones2}
top_phones <- read_html("https://www.amazon.in/mobile-phones/b?ie=UTF8&node=1389401031&ref_=nav_shopall_sbc_mobcomp_all_mobiles")
top_phones
```

## {data-background="img/ws_mobile_brand_name.png"}

## Brand Name

<hr>

```{r phones3}
top_phones %>%
  html_nodes(".crwTitle a") %>%
  html_text() %>%
  str_split('\\(') %>%
  map_chr(1) %>%
  str_trim() -> mobile_name

mobile_name
```

## {data-background="img/ws_mobile_color.png"}

## Color

<hr>

```{r phones 3b}
top_phones %>%
  html_nodes(".crwTitle a") %>%
  html_text() %>%
  str_split('\\(') %>%
  map_chr(2) %>%
  str_split(",") %>%
  map_chr(1) -> mobile_color

mobile_color
```

## {data-background="img/ws_mobile_rating.png"}

## Rating

<hr>

```{r phones4}
top_phones %>%
  html_nodes(".crwProductDetail span .a-icon-alt") %>%
  html_text() %>%
  str_sub(start = 1, end = 3) %>%
  as.numeric() -> mobile_rating

mobile_rating
```

## {data-background="img/ws_mobile_reviews.png"}

## Number of Reviews

<hr>

```{r phones5}
top_phones %>%
  html_nodes(".crwProductDetail span.a-size-small .a-link-normal") %>%
  html_text() %>%
  str_replace(",", "") %>%
  as.numeric() -> mobile_review

mobile_review
```

## {data-background="img/ws_real_price.png"}

## Real Price

<hr>

```{r phones6}
top_phones %>%
  html_nodes(".crwProductDetail .crwPrice .a-text-strike") %>%
  html_text() %>%
  str_trim() %>%
  str_sub(start = 5) %>%
  str_replace(",", "") %>%
  str_split("\\.") %>%
  map_chr(1) %>%
  as.numeric() -> real_price

real_price
```

## {data-background="img/ws_actual_price.png"}

## Discounted Price

<hr>

```{r phones7}
top_phones %>%
  html_nodes(".crwProductDetail .crwActualPrice") %>%
  html_text() %>%
  str_trim() %>%
  str_sub(start = 5) %>%
  str_replace(",", "") %>%
  str_split("\\.") %>%
  map_chr(1) %>%
  as.numeric() -> discounted_price

discounted_price
```

## Putting it all together...

<hr>

```{r phones8}
best_sellers <- tibble(title = mobile_name, color = mobile_color, 
  rating = mobile_rating, reviews = mobile_review, `Real Price (Rs.)` = real_price,
  `Discount Price (Rs.)` = discounted_price)

best_sellers
```

## {data-background="img/ws_cs_imdb_top_50.png"}

## robotstxt

<hr>

```{r imdb1}
paths_allowed(
  paths = c("https://www.imdb.com/search/title?groups=top_250&sort=user_rating")
)
```

## Read Web Page

<hr>

```{r imdb2}
imdb <- read_html("https://www.imdb.com/search/title?groups=top_250&sort=user_rating")
imdb
```

## {data-background="img/ws_imdb_movie_name.png"}

## Title

<hr>

```{r imdb3}
imdb %>%
  html_nodes(".lister-item-content h3 a") %>%
  html_text() -> movie_title

movie_title
```

## {data-background="img/ws_imdb_movie_year.png"}

## Year of Release

<hr>

```{r imdb4}
imdb %>%
  html_nodes(".lister-item-content h3 .lister-item-year") %>%
  html_text() %>%
  str_sub(start = 2, end = 5) %>%
  as.Date(format = "%Y") %>%
  year() -> movie_year

movie_year
```

## {data-background="img/ws_imdb_movie_certificate.png"}

## Certificate

<hr>

```{r imdb5}
imdb %>%
  html_nodes(".lister-item-content p .certificate") %>%
  html_text() -> movie_certificate

movie_certificate
```

## {data-background="img/ws_imdb_movie_runtime.png"}

## Runtime

<hr>

```{r imdb6}
imdb %>%
  html_nodes(".lister-item-content p .runtime") %>%
  html_text() %>%
  str_split(" ") %>%
  map_chr(1) %>%
  as.numeric() -> movie_runtime

movie_runtime
```

## {data-background="img/ws_imdb_movie_genre.png"}

## Genre

<hr>

```{r imdb7}
imdb %>%
  html_nodes(".lister-item-content p .genre") %>%
  html_text() %>%
  str_trim() -> movie_genre

movie_genre
```

## {data-background="img/ws_imdb_movie_rating.png"}

## Rating

<hr>

```{r imdb8}
imdb %>%
  html_nodes(".ratings-bar .ratings-imdb-rating") %>%
  html_attr("data-value") %>% 
  as.numeric() -> movie_rating

movie_rating
```

## {data-background="img/ws_imdb_movie_votes.png"}

## {data-background="img/ws_htmL_xpath.png"}

## Votes

<hr>

```{r imdb9}
imdb %>%
  html_nodes(xpath = '//meta[@itemprop="ratingCount"]') %>% 
  html_attr('content') %>% 
  as.numeric() -> movie_votes

movie_votes
```

## {data-background="img/ws_imdb_movie_revenue.png"}

## Revenue

<hr>

```{r imdb10}
imdb %>%
  html_nodes(xpath = '//span[@name="nv"]') %>%
  html_text() %>%
  str_extract(pattern = "^\\$.*") %>%
  na.omit() %>%
  as.character() %>%
  append(values = NA, after = 30) %>%
  append(values = NA, after = 46) %>%
  str_sub(start = 2, end = nchar(.) - 1) %>%
  as.numeric() -> movie_revenue

movie_revenue
```  

## Putting it all together...

<hr>

```{r imdb11}
top_50 <- tibble(title = movie_title, release = movie_year, 
    `runtime (mins)` = movie_runtime, genre = movie_genre, rating = movie_rating, 
    votes = movie_votes, `revenue ($ millions)` = movie_revenue)

top_50
```

## {data-background="img/ws_cs_top_websites.png"}

## robotstxt

<hr>

```{r web1}
paths_allowed(
  paths = c("https://www.similarweb.com/top-websites")
)
```

## Read Web Page

<hr>

```{r web2}
top_sites <- read_html("https://www.similarweb.com/top-websites")
top_sites
```

## Website Ranking

<hr>

```{r web3}
top_sites %>%
  html_node("table") %>%
  html_table() -> ranking

ranking
```

## Rename Columns

<hr>

```{r web5}
col_names <- c("ranking", "domain", "category", "change", 
  "avg_time_on_site", "avg_pages_per_visit", "bounce_rate")
colnames(ranking) <- col_names
head(ranking)
```

## Top Categories

<hr>

```{r web6}
ranking %>%
  count(category, sort = TRUE)
```

## {data-background="img/ws_cs_rbi_governors.png"}

## robotstxt

<hr>

```{r rbi1}
paths_allowed(
  paths = c("https://en.wikipedia.org/wiki/List_of_Governors_of_Reserve_Bank_of_India")
)
```

## Read Web Page

<hr>

```{r rbi2}
rbi_guv <- read_html("https://en.wikipedia.org/wiki/List_of_Governors_of_Reserve_Bank_of_India")
rbi_guv
```

## List of Governors

<hr>

```{r rbi3}
rbi_guv %>%
  html_nodes("table") %>%
  html_table() %>%
  extract2(2) -> profile

profile
```

## Sort

<hr>

```{r rbi5}
profile %>%
  separate(`Term in office`, into = c("term", "days")) %>%
  select(Officeholder, term) %>%
  arrange(desc(as.numeric(term)))
```

## Backgrounds

<hr>

```{r rbi6}
profile %>%
  count(Background) 
```

## Backgrounds

<hr>

```{r rbi7}
profile %>%
  pull(Background) %>%
  fct_collapse(
    Bureaucrats = c("IAS officer", "ICS officer",
    "Indian Administrative Service (IAS) officer",
    "Indian Audit and Accounts Service officer",
    "Indian Civil Service (ICS) officer"),
    `No Info` = c(""),
    `RBI Officer` = c("Career Reserve Bank of India officer")
  ) %>%
  fct_count() %>%
  rename(background = f, count = n) -> backgrounds
```

## Backgrounds

<hr>

```{r rbi8}
backgrounds
```

## Backgrounds

<hr>

```{r rbi9, fig.align='center', fig.height=4}
backgrounds %>%
  ggplot() +
  geom_col(aes(background, count), fill = "blue") +
  xlab("Background") + ylab("Count") +
  ggtitle("Background of RBI Governors")
```

## {data-background="img/ws_section_summary.png"}

## Summary

<hr>

> - web scraping is the extraction of data from web sites
> - best for static & well structured HTML pages
> - review robots.txt file  
> - HTML code can change any time
> - if API is available, please use it
> - do not overwhelm websites with requests

## {data-background="img/thankyou.png"}

