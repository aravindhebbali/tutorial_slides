---
output: _output.yaml
---

## {data-background="img/regex_cover_image.png"}

## Connect With Us

<hr>

- Website     (https://www.rsquaredacademy.com/)
- Free Online R Courses   (https://rsquared-academy.thinkific.com/)
- R Packages  (https://pkgs.rsquaredacademy.com)
- Shiny Apps  (https://apps.rsquaredacademy.com)
- Blog        (https://blog.rsquaredacademy.com)
- GitHub      (https://github.com/rsquaredacademy)
- YouTube     (https://www.youtube.com/user/rsquaredin/)
- Twitter     (https://twitter.com/rsquaredacademy)
- Facebook    (https://www.facebook.com/rsquaredacademy/)
- Linkedin    (https://in.linkedin.com/company/rsquared-academy)

## Resources

<hr>

- <a href="https://slides.rsquaredacademy.com/decision-trees/trees.html" target="_blank">Slides</a>
- <a href="https://github.com/rsquaredacademy-education/online-courses/tree/master/decision-trees-in-r" target="_blank">Code & Data</a>
- <a href="https://rstudio.cloud/project/356612" target="_blank">RStudio Cloud</a>

## {data-background="img/ws_agenda.png"}

<br>
<br>
<br>
<br>

- what is a decision tree?


## {data-background="img/ws_section_intro.png"}

## What?

<hr>

## Classification

<hr>

## Scoring

<hr>

## Estimation

<hr>

## Finding the Split

<hr>

## Splitting on Numeric Variable

<hr>

## Splitting on Categorical Variable

<hr>

## Handling Missing Values

<hr>

## Growing the Tree

<hr>

## Effectiveness of the Tree

<hr>

## Choosing the best Split

<hr>

- Gini
- Entropy
- Information Gain Ratio
- Chi Square Test
- Reduction in Variance
- F Test

## Gini 

<hr>

## Entropy

<hr>

## Information Gain Ratio

<hr>

## Chi-Square Test

<hr>

## Reduction in Variance

<hr>

## F Test

<hr>

## Pruning

<hr>

## Extracting Rules

<hr>

## Cost

<hr>

## Visualization

<hr>
 
## Libraries

<hr>

```{r install, eval=TRUE, message=FALSE, warning=FALSE}
library(readr)        # read csv data
library(dplyr)
library(rpart)        # recursive partitioning
library(rpart.plot)   # visualization
library(mbar)         # best cp for tree pruning
library(rattle)       # visualization
library(RColorBrewer) # plot colors
library(magrittr)     # pipes
library(caret)        # confusion matrix, cross validation, bagging
library(rsample)      # data partition
library(parsnip)      # unified interface
library(ROCR)         # roc curves
library(yardstick)    # roc curves & classification matrix
```

## Data

<hr>

```{r read_data, message=FALSE}
hr_data <- 
  read_csv("data/hr-attrition.csv") %>%
  select(-Over18) 
hr_data$Attrition <- as.factor(hr_data$Attrition)
```

## Data Partitioning

<hr>

```{r data_split}
set.seed(123)
hr_split <- initial_split(hr_data, prop = .7)
hr_train <- training(hr_split)
hr_test  <- testing(hr_split)
```

## Grow Tree

<hr>

```{r grow_tree}
tree_control <-
  rpart.control(
    minsplit     = 20,
    minbucket    = 7,
    maxdepth     = 10,
    usesurrogate = 2, 
    xval         = 10
  )

model <- 
  rpart(Attrition ~ ., 
        data = hr_train,
        method = "class",
        control = tree_control)
```

## Grow Tree

<hr>

```{r grow_tree_2}
model
```

## Visualize 

<hr>

```{r viz_tree, fig.align="center"}
par(xpd = NA)
plot(model)
text(model, digits = 3)
```

## Tree Summary

<hr>

```{r tree_summary}
summary(model)
```

## Complexity Parameter

<hr>

```{r printcp}
printcp(model)
```

## Plot Complexity Parameter

<hr>

```{r plotcp, fig.align='center'}
plotcp(model)
```

## Visualize Tree

<hr>

```{r prp_tree, fig.align='center'}
prp(model)
```

## Optimal CP

<hr>

```{r findcp}
best_cp <- mbar::optimal_cp(model)
best_cp
```

## Prune Tree

<hr>

```{r prune_tree}
pruned_model <- prune(model, cp = best_cp)
pruned_model
```

## Fancy Plot

<hr>

```{r fancy_plot, fig.align='center'}
fancyRpartPlot(pruned_model, uniform = TRUE)
```

## Predict

<hr>

```{r predict_tree}
predictions <- predict(pruned_model, hr_test, type="class")
predictions
```

## Confusion Matrix

<hr>

```{r cm_tree}
confusionMatrix(predictions, hr_test$Attrition)
```

## ROC Curve

```{r tree_roc, fig.align="center"}
perform <- tree_prediction(pruned_model, hr_test, Attrition)
plot_roc(perform)
```

## Precision Recall Curve

<hr>

```{r tree_prec, fig.align="center"}
plot_prec_rec(perform)
```

## Sensitivity Specificity Plot

<hr>

```{r tree_spec, fig.align="center"} 
plot_sens_spec(perform)
```

## Lift Curve

<hr>

```{r tree_lift, fig.align="center"}
plot_lift_curve(perform)
```

## Area Under Curve

<hr>

```{r tree_auc} 
tree_auc(perform)
```

## Using caret

<hr>

```{r use_caret}
tree_fit <- train(Attrition ~., data = hr_train, method = "rpart",
                   parms = list(split = "information"),
                   trControl= trainControl("cv", number = 10),
                   tuneLength = 10)
tree_fit
```

## Plot

<hr>

```{r plot_caret, fig.align='center'}
prp(tree_fit$finalModel, box.palette = "Reds", tweak = 1.2)
```

## Predict

<hr>

```{r predict_caret}
predict_on_test <- predict(tree_fit, newdata = hr_test)
predict_on_test
```

## Confusion Matrix

<hr>

```{r cm_caret}
confusionMatrix(predict_on_test, hr_test$Attrition)
```

## Gini

<hr>

```{r caret_gini}
tree_fit <- train(Attrition ~., data = hr_train, method = "rpart",
                   parms = list(split = "gini"),
                   trControl = trainControl("cv", number = 10),
                   tuneLength = 10)
tree_fit
```

## Use tidymodels

<hr>

```{r tidy_model}
model <- decision_tree(mode = "classification", tree_depth = 5) 
model
```

## Fit rpart

<hr>

```{r tidy_fit}
model %>%
  set_engine("rpart") %>%
  fit(Attrition ~ ., data = hr_train)
```

## Fit C5.0

<hr>

```{r fir_c50}
model %>%
  set_engine("C5.0") %>%
  fit(Attrition ~ ., data = hr_train)
```

## Set Options

<hr>

```{r set_options}
model <- decision_tree()

model %>%
  set_mode("classification") %>%
  set_args(tree_depth = 5) %>%
  set_engine("rpart") %>%
  fit(Attrition ~ ., data = hr_train)
```

## Varying Parameters

<hr>

```{r varying_parameters}
model <- decision_tree(tree_depth = varying())

model %>%
  set_mode("classification") %>%
  set_args(tree_depth = 5) %>%
  set_engine("rpart") %>%
  fit(Attrition ~ ., data = hr_train)
```

## Summary

<hr>

## References

<hr>

## {data-background="img/thankyou.png"}
